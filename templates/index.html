<!html>
<html>
<head>
    <title>Palermo Hollywood, FTW</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='normalize.min.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='leaflet-0.6.4/leaflet.css') }}" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="{{ url_for('static', filename='leaflet-0.6.4/leaflet.ie.css') }}" />
    <![endif]-->
    <style type="text/css">
        html {
            margin: 0;
            padding: 0;
        }
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: relative;
            width: 100%;
            height: 100%;
        }

        form {
            margin: 0;
        }
    </style>
    <script src="{{ url_for('static', filename='jquery-1.10.2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='leaflet-0.6.4/leaflet.js') }}"></script>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
    var map = L.map('map').setView([-34.607214907435875, -58.440399169921875], 12);
   var stamenUrl = 'http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png';
    var stamenAttribution = 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.';
    var stamenLayer = new L.TileLayer(stamenUrl, {maxZoom: 18, attribution: stamenAttribution});
    map.addLayer(stamenLayer);

    var radiusConstant = 0.5;
    var getRadius = function(value) {
        return Math.sqrt(value)*radiusConstant;
    };
//'187_total', '501_total', '502_total',
//        '503_total', '505_total', '506_total',
    var list2color = {
        187: 'red',
        501: 'blue',
        502: 'yellow',
        503: 'green',
        505: 'purple',
        506: 'pink',
    }

    $.getJSON("/static/results.geojson", function(response) {
        var tileLayer = L.tileLayer('/static/tiles/buenos-aires-election-2013-arrows/{z}/{x}/{y}.png');
        var dataLayer = L.geoJson(response, {
            pointToLayer: function (feature, latlng) {
                var marker = new L.circleMarker(latlng, {
                    fillColor: list2color[feature.properties['leader']],
                    color: list2color[feature.properties['leader']],
                    fillOpacity: 0.4,
                    weight: 1
                })
                .setRadius(getRadius(feature.properties['margin_of_victory']))
                .bindPopup(
                    "<b>" + feature.properties['establecim'] + "</b><br>" +
                    feature.properties['direccion']
                );
                return marker;
            }
        });

        L.control.layers({
            'Arrow Layer': tileLayer.addTo(map),
            'Bubble Layer': dataLayer
        }, null, {collapsed: false}).addTo(map);
    });

    </script>
</body>
</html>
