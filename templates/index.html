<!DOCTYPE html>
<html>
<head>
    <title>Palermo Hollywood, FTW</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='normalize.min.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='leaflet-0.6.4/leaflet.css') }}" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="{{ url_for('static', filename='leaflet-0.6.4/leaflet.ie.css') }}" />
    <![endif]-->
    <style type="text/css">
        html {
            margin: 0;
            padding: 0;
        }
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            position: relative;
            width: 100%;
            height: 100%;
        }

        form {
            margin: 0;
        }
    </style>
    <script src="{{ url_for('static', filename='jquery-1.10.2.min.js') }}"></script>
    <script src="{{ url_for('static', filename='leaflet-0.6.4/leaflet.js') }}"></script>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
    var map = L.map('map').setView([-34.607214907435875, -58.440399169921875], 12);
    // Base tiles
    var mapquestLayer = new L.TileLayer('http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Data, imagery and map information provided by <a href="http://open.mapquest.co.uk" target="_blank">MapQuest</a>,<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors.',
        subdomains: ['otile1','otile2','otile3','otile4']
    });
    map.addLayer(mapquestLayer);

    // Styling tricks
    var radiusConstant = 0.5;
    var getRadius = function(value) {
        return Math.sqrt(value)*radiusConstant;
    };

    var list2color = {
        '501': '#50ade6', // light blue
        '502': '#6eb440', // green
        '503': '#ffda00'  // yellow
    }

    $.getJSON("{{ url_for('static', filename='results.geojson') }}", function(response) {
        var tileLayer = L.tileLayer("{{ url_for('static', filename='tiles/') }}buenos-aires-election-2013-arrows/{z}/{x}/{y}.png");
        var dataLayer = L.geoJson(response, {
            pointToLayer: function (feature, latlng) {
                var marker = new L.circleMarker(latlng, {
                    fillColor: list2color[feature.properties['leader']],
                    color: list2color[feature.properties['leader']],
                    fillOpacity: 0.4,
                    weight: 1
                })
                .setRadius(getRadius(feature.properties['margin_of_victory']))
                .bindPopup(
                    "<b>" + feature.properties['establecim'] + "</b><br>" +
                    feature.properties['direccion']
                );
                return marker;
            }
        });

        L.control.layers({
            'Arrow Layer': tileLayer.addTo(map),
            'Bubble Layer': dataLayer
        }, null, {collapsed: false}).addTo(map);
    });

    </script>
</body>
</html>
